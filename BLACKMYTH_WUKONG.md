# BLACKMYTH_WUKONG 抢票平台设计

## 平台设计思路

1、根据前期的分析，想要实现半自动化，首先明白票务平台内部流程 1）添加联系人信息、添加游客信息，2）监听票务信息，3）监听到票务有票，4）提交订单

2、那么我们前端部分的输入信息基本就包括几部分

- 账号使用的认证信息：Authorization("xxxxxxxxxxxxxxxxxxxxxxxxx") PS:目前来看两天都还没变，暂时不确认有效期
- 需要抢票的类型：全价(scenicProductId：10396)、半价(scenicProductId：10397)、儿童(scenicProductId：10398)、老人(scenicProductId：10399) PS:要能够支持多选
- 需要抢票的日期和时间段：(day: "2025-05-08", title: "09:00~11:00") PS:要支持范围覆盖
- 抢票人姓名、身份证和手机号：(name: 武 xx, idCard: 412412412414141xxxxx, mobile：xxxxxxxxxxxxxx) PS:要支持文件导入

3、其中票务信息监听部分可以先做出来(因为查询可售日期和当天库存部分的接口不需要鉴权)(可以做出两个版本来，一个挂载到 gitpage 上，在用户本地浏览器中不断运行，一个在作为后台服务运行，可以支持生成库存表)

4、那么我们的模块可以分为：

- 逻辑部分-票务信息监听模块: 主要请求\${baseUrl}/product/month/priceList 和\${baseUrl}/product/getSessionList/\${dayId}两个接口获取票务库存信息，因为需要频繁访问最好能使用 IP 池，避免 IP 被 ban
- 逻辑部分-抢票模块: 抢票部分希望分为两部分，集中抢票模式(在晚上 12 点刷新的时候去抢，此时不执行票务信息监听模块，而选择一直提交订单直到返回提交订单成功)，监听抢票模式(此时先走票务信息监听模块，当确认在预期时间段内有可预约库存时，再发送预约请求)
- 逻辑部分-持久化存储模块：需要支持多实例（也就是多窗口打开时）互不干扰
- 前端部分-信息展示模块：包括以下部分：前端前端日志提示信息部分、当前库存信息展示部分、当前抢票人信息
- 前端部分-抢票信息输入模块：主要包含以下输入部分：1、账号认证信息（字符串输入框），2、需要抢票类型（复选框），3、抢票日期和时间段（两个字符串输入框），4、抢票人姓名、身份证和手机号（三个输入框）

## V1 版本实现票务监控系统

```
curl --request GET \
  --url 'https://apiuserv6.zhongzhiyou.cn/product/month/priceList?month=202505&scenicProductId=10396'
```

首先构造票务可售日期的 GET 请求，其中 month 参数为通用日期，请使用当前日期生成，scenicProductId 参数为产品类型，我们此时可以通过复选框选择监控 10396 和 10397 两种类型

存储查询回来的数据类型到 priceList，并添加对应的 scenicProductId 到每一类下面，其中 scenicProductId 替换为对应的产品类型 id

记得加入错误处理，如果报错则不进行下一步

```
curl --request GET \
  --url https://apiuserv6.zhongzhiyou.cn/product/getSessionList/997109
```

其次构造获取票务特定某日的库存信息的 GET 请求，其中 997109 为日期 id，该参数需要在第一个请求返回的结果 priceList 中 data 列表中遍历，当 enabled 为 true 时，则使用 id 作为该请求的日期 id 发送获取票务特定某日的库存信息请求

将上述遍历的结果结合存储起来，需要将日期 id 与对应的结果使用恰当的方式一起存储起来，方便后续调用

上述流程需要每 60s 执行一次

最后将每次执行结果在网页上通过表格展示出来，需要包含日期(day/id)、时间段(title)、库存数(stockNumber)
