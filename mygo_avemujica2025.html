<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API 数据实时展示</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #282a36;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      font-smooth: always;
      margin: 0;
    }

    .scroll-container {
      width: 100%;
      max-width: 100vw;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    table {
      border-collapse: collapse;
      width: auto;
      color: white;
    }

    th,
    td {
      border: 1px solid #6272a4;
      padding: 10px;
      text-align: left;
      white-space: nowrap;
      /* 防止文本换行 */
    }

    th {
      background-color: #282a36;
      color: #ff79c6;
    }
  </style>
</head>

<body>
  <div class="scroll-container">
    <table id="dataTable"></table>
  </div>
  <script>
    const apiUrl =
      "https://admin.nolets.jp/V5/API/users/item?login_id=saas%40faker.faker&access_token=1b35b5c8ef2b14e6bd2db414f1b34cc2eb3a91ad&host=nolets.jp&app=order&store_id=11987&method=system&limit=2000&offset=0&fhtg=2&category_id=all&start_datetime=20250418&end_datetime=20250418&session_id=96m9maxow5";

    const getItemList = (data) => {
      return data?.ItemsInfo.map((item) => {
        const currentStock = item.total_stock === -1 ? 0 : item.total_stock;
        const salesAmount = item.max_sale_stock - currentStock;
        return {
          name: item.name,
          price: item.value,
          total_stock: item.total_stock,
          sales_amount: salesAmount,
          max_sale_stock: item.max_sale_stock,
          person_stock: item.person_stock,
        };
      });
    };

    async function drawDataOnTable() {
      try {
        const response = await fetch(apiUrl, {
          headers: {
            Accept: "application/json, text/plain, */*"
          }
        });
        if (!response.ok) {
          throw new Error('网络请求失败');
        }
        const data = await response.json();
        const itemList = getItemList(data);

        const table = document.getElementById('dataTable');
        table.innerHTML = '';

        const currentDate = new Date();
        const timestamp = `${currentDate.getFullYear()}-${String(
          currentDate.getMonth() + 1
        ).padStart(2, '0')}-${String(currentDate.getDate()).padStart(
          2,
          '0'
        )}_${String(currentDate.getHours()).padStart(2, '0')}-${String(
          currentDate.getMinutes()
        ).padStart(2, '0')}-${String(currentDate.getSeconds()).padStart(2, '0')}`;
        const title = `mygo_avemujica 场贩库存 - 北京时间${timestamp}`;
        const caption = document.createElement('caption');
        caption.textContent = title;
        caption.style.color = '#ff79c6';
        caption.style.fontSize = '28px';
        caption.style.padding = '10px';
        table.appendChild(caption);

        const headers = Object.keys(itemList[0]);
        const chineseHeaders = {
          name: "商品名称",
          price: "价格",
          total_stock: "当前库存",
          sales_amount: "销售额",
          max_sale_stock: "总库存",
          person_stock: "个人限购"
        };

        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');
        headers.forEach((header) => {
          const th = document.createElement('th');
          th.textContent = chineseHeaders[header] || header;
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);
        table.appendChild(thead);

        const tbody = document.createElement('tbody');
        const colors = ["#8be9fd", "#50fa7b", "#bd93f9", "#ffb86c", "#ff5555"];
        itemList.forEach((row, rowIndex) => {
          const tr = document.createElement('tr');
          headers.forEach((header, index) => {
            const td = document.createElement('td');
            let text = row[header];
            td.textContent = text;
            td.style.color = colors[index % colors.length];
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });
        table.appendChild(tbody);
      } catch (error) {
        console.error('数据加载出错:', error);
      }
    }

    drawDataOnTable();
    setInterval(drawDataOnTable, 20000);
  </script>
</body>

</html>